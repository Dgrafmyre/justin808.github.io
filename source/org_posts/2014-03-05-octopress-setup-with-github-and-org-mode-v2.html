<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>2014-03-05-octopress-setup-with-github-and-org-mode-v2</title>
<!-- 2014-03-07 Fri 07:33 -->
<meta  http-equiv="Content-Type" content="text/html;charset=utf-8" />
<meta  name="generator" content="Org-mode" />
<meta  name="author" content="Justin Gordon" />
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  .title  { text-align: center; }
  .todo   { font-family: monospace; color: red; }
  .done   { color: green; }
  .tag    { background-color: #eee; font-family: monospace;
            padding: 2px; font-size: 80%; font-weight: normal; }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  { margin-left: auto; margin-right: 0px;  text-align: right; }
  .left   { margin-left: 0px;  margin-right: auto; text-align: left; }
  .center { margin-left: auto; margin-right: auto; text-align: center; }
  .underline { text-decoration: underline; }
  #postamble p, #preamble p { font-size: 90%; margin: .2em; }
  p.verse { margin-left: 3%; }
  pre {
    border: 1px solid #ccc;
    box-shadow: 3px 3px 3px #eee;
    padding: 8pt;
    font-family: monospace;
    overflow: auto;
    margin: 1.2em;
  }
  pre.src {
    position: relative;
    overflow: visible;
    padding-top: 1.2em;
  }
  pre.src:before {
    display: none;
    position: absolute;
    background-color: white;
    top: -10px;
    right: 10px;
    padding: 3px;
    border: 1px solid black;
  }
  pre.src:hover:before { display: inline;}
  pre.src-sh:before    { content: 'sh'; }
  pre.src-bash:before  { content: 'sh'; }
  pre.src-emacs-lisp:before { content: 'Emacs Lisp'; }
  pre.src-R:before     { content: 'R'; }
  pre.src-perl:before  { content: 'Perl'; }
  pre.src-java:before  { content: 'Java'; }
  pre.src-sql:before   { content: 'SQL'; }

  table { border-collapse:collapse; }
  caption.t-above { caption-side: top; }
  caption.t-bottom { caption-side: bottom; }
  td, th { vertical-align:top;  }
  th.right  { text-align: center;  }
  th.left   { text-align: center;   }
  th.center { text-align: center; }
  td.right  { text-align: right;  }
  td.left   { text-align: left;   }
  td.center { text-align: center; }
  dt { font-weight: bold; }
  .footpara:nth-child(2) { display: inline; }
  .footpara { display: block; }
  .footdef  { margin-bottom: 1em; }
  .figure { padding: 1em; }
  .figure p { text-align: center; }
  .inlinetask {
    padding: 10px;
    border: 2px solid gray;
    margin: 10px;
    background: #ffffcc;
  }
  #org-div-home-and-up
   { text-align: right; font-size: 70%; white-space: nowrap; }
  textarea { overflow-x: auto; }
  .linenr { font-size: smaller }
  .code-highlighted { background-color: #ffff00; }
  .org-info-js_info-navigation { border-style: none; }
  #org-info-js_console-label
    { font-size: 10px; font-weight: bold; white-space: nowrap; }
  .org-info-js_search-highlight
    { background-color: #ffff00; color: #000000; font-weight: bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>
</head>
<body>
<div id="content">
<h1 class="title">2014-03-05-octopress-setup-with-github-and-org-mode-v2</h1>
<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1. Basic setup</a></li>
<li><a href="#sec-2">2. Some Perspectives on how Octopress Works</a>
<ul>
<li><a href="#sec-2-1">2.1. Posts</a></li>
<li><a href="#sec-2-2">2.2. Pages</a></li>
</ul>
</li>
<li><a href="#sec-3">3. POW</a></li>
<li><a href="#sec-4">4. Automatically Generating the Site</a></li>
<li><a href="#sec-5">5. Org-Mode</a>
<ul>
<li><a href="#sec-5-1">5.1. Why org-mode for blog publishing?</a></li>
<li><a href="#sec-5-2">5.2. Org-mode Integration</a></li>
</ul>
</li>
<li><a href="#sec-6">6. Useful Scripts</a></li>
<li><a href="#sec-7">7. Emacs setup</a></li>
<li><a href="#sec-8">8. Deploying to Github: Directory Structure of Octopress and the master and source Git Branches</a></li>
<li><a href="#sec-9">9. Useful Links</a></li>
<li><a href="#sec-10">10. Live Reload</a></li>
<li><a href="#sec-11">11. Parting words&#x2026;</a></li>
</ul>
</div>
</div>
---
layout: post
title: "Org-Mode Octopress Setup v2"
date: 2014-03-05 19:37
comments: true
categories: [octopress, org-mode]
alias: /tips/org-octopress/index.html
keywords: octopress, github, org-mode, emacs, livereload
description: Installing Octopress with github hosting, Org Mode markup, and Live-Reload, updated for org-mode 8.2x and Emacs 24
---

<p>
<i>Note: This is a refresh of my original post from April, 2013 to adjust for Emacs 24.3 and org-mode 8.2.x</i>
</p>

<p>
WordPress seemed like a good blogging platform, but it just didn't feel right. I
spend all my day editing text files using vim key-bindings, and I love <a href="http://orgmode.org/">Org Mode</a>
for all non-coding writing. If you don't know Org Mode, it's like having
Markdown mode on steroids. You can have a numbered list in Markdown, but
org-mode lets you re-order the list, and that's just the beginning. Editing blog
documents in the WordPress editor felt almost as bad as being told to use MS
Word. I found that ergonomics of Org Mode, including all the goodness of recent
versions of <a href="http://www.gnu.org/software/emacs/">Emacs</a>, including <a href="http://www.emacswiki.org/emacs/Evil">Evil</a> (Vim emulation), just made organization of
creative thoughts so much more enjoyable.
</p>

<p>
So I bit the bullet one weekend, and dove into <a href="http://octopress.org/">Octopress</a>, publishing my first
article, <a href="http://www.railsonmaui.com/blog/2013/04/27/octopress-setup-with-github-and-org-mode/">Octopress Setup with Github, Org Mode, and LiveReload</a>. The solution
presented in that article <a href="http://blog.paphus.com/blog/2012/08/01/introducing-octopress-blogging-for-org-mode/">Introducing Octopress Blogging for Org-Mode</a> stopped
working when I upgraded Emacs to 24.3 and org-mode to 8.2.x. Here's a rehash of
my original article updated to the latest software versions as of March, 2014.
</p>

<p>
If you used to writing real web applications, rather than know the intricacies
of a giant monolithic blogging platform, then the <a href="http://octopress.org/docs/theme/template/">customization of Octopress</a>
seems so much more straightforward. This is so much more like the Unix
philosophy that so many of us love, which is small and modular, rather than
monolithic.
</p>

<!-- more -->

<p>
I like <a href="https://github.com/robdodson/robdodson.github.com/blob/source/source/_posts/2012-04-30-custom-domain-with-octopress-and-github-pages.markdown">Rob Dodson's summary</a> (noting Org Mode plus Emacs):
</p>

<ul class="org-ul">
<li><a href="http://octopress.org/">Octopress</a> is a blogging framework written by <a href="http://brandonmathis.com/">Brandon Mathis</a> (<a href="https://twitter.com/#!/imathis">@imathis</a>) which
sits on top of <a href="https://github.com/mojombo/jekyll">Jekyll</a>. Jekyll is a static site generator, meaning there's no
database associated with your blog. Instead of writing everything in a WSYWIG
linked to MySQL (like Wordpress or Blogger) you produce text files using
Markdown which are then converted to static HTML. There are 3 huge benefits to
this approach. First, writing in Markdown (<b>org-mode</b> for me) is awesome. Once
you learn the syntax it's incredibly fast and you don't have to spend time
playing with a tiny little editor window just to add <i>some</i> <b>style</b> to your
posts. Second, writing in your favorite text editor is also awesome. I produce
everything in Sublime Text 2 (<b>Emacs</b> for me) and every day I discover new
tricks to make the process better. If you've ever had to write a blog post
using one of those horrible little TinyMCE editors you will appreciate this
feature. And lastly, static HTML is <b>fast</b>.
</li>
</ul>

<p>
This article should be useful for:
</p>
<ol class="org-ol">
<li>Any interest in using org-mode to publish to Octopress including some
reasons I use Org Mode (with Emacs).
</li>
<li>Some explanation of what Octopress and git are doing.
</li>
<li>Anybody curious about how using free github pages works to host Octopress.
</li>
</ol>

<p>
Incidentally, since my blog is hosted using github pages, the source code and
configuration I use to generate it can all be found <a href="https://github.com/justin808/justin808.github.io">here</a>. See the notes below on
the difference between the <code>source</code> and <code>master</code> branches.
</p>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Basic setup</h2>
<div class="outline-text-2" id="text-1">
<ol class="org-ol">
<li><a href="http://robdodson.me/blog/2012/04/30/custom-domain-with-octopress-and-github-pages/">Rob Dodson on Octopress</a>: Start off with these instructions from this posting
on April 30th, 2012. There are a few differences worth noting:
<ol class="org-ol">
<li>You should change the .rvmrc to a .ruby-version file
</li>
<li>Github recommends your deployment repository be named <code>yourname.github.io</code>,
not <code>yourname.github.com</code>.
</li>
<li>After you run <code>rake setup_github_pages</code> and before running <code>rake
      generate</code>, you should run <code>rake install</code>. If you forget, there's a clear
message indicating this omission.
</li>
</ol>
</li>
<li>Customize <code>octopress/_config.yml</code>. The yaml file contains descriptions.
</li>
<li>Update the DNS to use your custom domain if you wish: <a href="https://help.github.com/articles/setting-up-a-custom-domain-with-pages">Github directions on
setting up a custom domain</a>
</li>
<li>At this point, you can create a post:
<div class="org-src-container">

<pre class="src src-bash">rake new_post["my post name"]
</pre>
</div>

<p>
Create a page:
</p>
<div class="org-src-container">

<pre class="src src-bash">rake new_page["my page name"]
</pre>
</div>

<p>
Generate and deploy:
</p>
<div class="org-src-container">

<pre class="src src-bash">rake gen_deploy
</pre>
</div>

<p>
Watch the site and regenerate when it changes:
</p>
<div class="org-src-container">

<pre class="src src-bash">rake watch
</pre>
</div>

<p>
Preview the site in a web browser:
</p>
<div class="org-src-container">

<pre class="src src-bash">rake preview
</pre>
</div>

<p>
See all the available rake options:
</p>
<div class="org-src-container">

<pre class="src src-bash">rake -T
</pre>
</div>

<p>
Save changes to source branch:
</p>
<div class="org-src-container">

<pre class="src src-bash">git add .
git commit -m "save changes to source"
git push origin source
</pre>
</div>
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Some Perspectives on how Octopress Works</h2>
<div class="outline-text-2" id="text-2">
</div><div id="outline-container-sec-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> Posts</h3>
<div class="outline-text-3" id="text-2-1">
<p>
<b>Posts</b> are created using the rake task <code>rake new_post["Post Title"]</code>. The key things about a post are:
</p>
<ol class="org-ol">
<li>File is located in =source/_posts.
</li>
<li>File has a header containing the meta-data for the post. The post URL and
date are determined by the by the <code>title</code> and <code>date</code> fields. If you want to
change the date of your post, then you change the meta-data. Changing the
file name is useful only for file navigation. Here's a <a href="https://gist.github.com/justin808/5550381">gist for a rake task
to update the file names to match the metadata</a>.
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Pages</h3>
<div class="outline-text-3" id="text-2-2">
<p>
<b>Pages</b> are created using the rake task <code>rake new_page["Page Title"]</code>. The key
things about a page are:
</p>
<ol class="org-ol">
<li>Files are located in <code>source/page-title</code>
</li>
<li>File has a header containing the meta-data for the post.
</li>
</ol>

<p>
I use "Pages" for things like <a href="http://www.railsonmaui.com/about">my "about" page.</a>
</p>
</div>
</div>
</div>
<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> POW</h2>
<div class="outline-text-2" id="text-3">
<p>
POW allows you to point your browser to <a href="http://octopress.dev">http://octopress.dev</a> to see your local,
unpublished Octopress website. It's very convenient to not have to remember to
run a local server, and it works great with LiveReload. Scroll to the bottom of
this link for details on <a href="http://octopress.org/docs/blogging/">POW</a>. The alternative to running POW is to run <code>rake
preview</code> and then point your browser at <code>http://0.0.0.0:4000</code> (or whatever port
you configured).
</p>
</div>
</div>
<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Automatically Generating the Site</h2>
<div class="outline-text-2" id="text-4">
<p>
Start a shell tab running this command: <code>rake generate &amp;&amp; rake watch</code>. Edit a
file in markdown or follow the instructions below to use org-mode.
</p>
</div>
</div>
<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Org-Mode</h2>
<div class="outline-text-2" id="text-5">
<p>
You can skip this section if you're not interested in org-mode. However, it's
super cool!
</p>
</div>
<div id="outline-container-sec-5-1" class="outline-3">
<h3 id="sec-5-1"><span class="section-number-3">5.1</span> Why org-mode for blog publishing?</h3>
<div class="outline-text-3" id="text-5-1">
<p>
<a href="http://orgmode.org/">Org-mode</a> offers quite a bit more than plain markdown. It's quite the <b>hacker's
delight</b> for note taking and authoring of blog articles. Down below I list a few
reasons why org-mode. Here's a few org-mode features I love (Some are Emacs
ones):
</p>
<ol class="org-ol">
<li>All headers and list items can be reordered with minimal keystrokes (think
super powerful outliner).
</li>
<li>Numbered lists.
</li>
<li>Editable tables in text editor, with movable columns, movable rows.
</li>
<li>Ergonomics of insertion of URLs and images.
</li>
<li>Includes the basics of markdown, such as source code blocks and much more.
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-5-2" class="outline-3">
<h3 id="sec-5-2"><span class="section-number-3">5.2</span> Org-mode Integration</h3>
<div class="outline-text-3" id="text-5-2">
<p>
The <a href="https://github.com/yoshinari-nomura/org-octopress">org-octopress</a> plugin automates the process of converting an org-mode
document (<code>.org</code> file) in <code>source/org_posts</code> into a <code>.html</code> document in
<code>source/_posts</code>. Once the html document is saved in _posts, the <code>rake watch</code>
task picks up the change and deploys the file. <b>Neat!</b>
</p>

<p>
Here are the basic steps:
</p>
<ol class="org-ol">
<li>Install Emacs 24.3 and use the package manager to install org-mode and
   <a href="https://github.com/yoshinari-nomura/org-octopress">org-octopress</a>.
</li>
<li>See my Emacs configuration below.
</li>
<li>Note, there are two ways to use org-octopress. I do not use its features to
automate the setup of the directories. This automated setup does not provide
a way to have "pages". As of March, 2014, you can only have "posts". Instead,
my configuration below handles the mapping of directories.
</li>
<li><del>Images work fine.</del> Well, almost fine. The big gotcha is that the standard
inclusion of images in org-mode results in broken paths at deployment. The
workaround is to embed the <a href="http://octopress.org/docs/plugins/image-tag/">Octopress syntax for an image</a>, and to place the
images under source/images. Note, you'll want to be sure to use an absolute
path, or else your article might look OK on the home page, but might now work
in the postings directory. If I'm creating a document with many images, I'll
group the images for that document in a sub-directory of images named like
the document. This is how it should look. The trick is to place the
octopress <code>img</code> directive within a HTML begin/end block.

<p>
{% img /images/2013-04-27-octopress-setup-with-github-and-org-mode/org-mode-images.png %}
</p>
</li>
<li><b>Links</b>: This is key thing to get right. It's critical to understand the
issues links, or else you'll have one of these issues:
<ol class="org-ol">
<li>Links work when you test your blog locally using <code>pow</code>, but not when you
go to your published website. This happens if you use a relative link from
blog articles, because blog articles sometimes appear on your home page
and sometimes under the <code>/blog</code> directory. You have to use your domain
address to link from blog articles to other articles on your blog.
</li>
<li>You'd like your local links to point to the correct local spot. You can do
this for links on static pages, but just not blog articles. Thus, for
non-blog articles, it's preferable to use the <code>file:</code> relative path format
(just not <code>file:/</code> absolute path).
</li>
</ol>
<p>
<b>Here's the rules:</b>
</p>

<p>
Links for relative static pages to pages and posts:
</p>
<pre class="example">
[[file:telecommuting.html][Why telecommuting works and how I maximize productivity]]
</pre>
<p>
Links from a <i>page</i> to a <i>post</i> can use a relative link like this:
</p>
<pre class="example">
[[file:../blog/2013/04/27/octopress-setup-with-github-and-org-mode/index.html][here]]
</pre>
<p>
<b>However</b>, links from posts to other posts require an absolute URL using your
published domain name. The big gotcha is blog posts due to the nested URL
structure that does not map to the where you're putting your org-posts. To
avoid trouble, you need to follow a format as this example shows. It's
easiest to copy the URL from the browser address bar.
</p>
<pre class="example">
[[http://www.railsonmaui.com/blog/2013/05/08/strategies-for-rails-logging-and-error-handling/][Strategies for Rails Logging and Error Handling]]
</pre>
<p>
I tried using a <code>file:../blog</code> syntax, but that either would work on the home
page or in the specific blog article, but not both. <code>http:/blog</code> links would
work in Chrome but not mobile Safari. Hopefully, one day we'll be able to
specify relative links from blog article to blog article. <i>For now, this is a
big <b>gotcha</b>.</i>
</p>
</li>
<li>Bold and italic styling (text inside of stars and /) was a bit of mystery
using the standard theme. Octopress has styling for <code>&lt;strong&gt;</code> and <code>&lt;em&gt;</code>. Org-mode spits out <code>&lt;b&gt;</code> and
<code>&lt;i&gt;</code> tags.
Add this to <code>sass/custom/_fonts.scss</code>.
<div class="org-src-container">

<pre class="src src-css"><span style="color: #93E0E3;">b </span>{ <span style="color: #DFAF8F;">font-weight</span>: bold; }
<span style="color: #93E0E3;">i </span>{ <span style="color: #DFAF8F;">font-style</span>: italic; }
</pre>
</div>

<p>
Code styling (text inside of equals) <code>like this</code> did not work after a code block unless I added
the <code>div</code> tag to this line around 100 in <code>_syntax.scss</code>. You're just adding
the <code>div</code> selector.
</p>
<div class="org-src-container">

<pre class="src src-css"><span style="color: #93E0E3;">// Sometimes html gen by org-mode misses p or li tags, so add div to the mix</span>
<span style="color: #93E0E3;">div, p, li </span>{
<span style="color: #93E0E3;">  code </span>{
    <span style="color: #DCDCCC; font-weight: bold;">@extend</span> .mono;
</pre>
</div>
</li>
</ol>
</div>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Useful Scripts</h2>
<div class="outline-text-2" id="text-6">
<ul class="org-ul">
<li>Just configure <code>OCTO_HOME</code>
</li>
<li>Emacs tip: Visit the created file by placing cursor over file name and then hit <code>Ctrl-x, f</code>.
</li>
</ul>
<div class="org-src-container">

<pre class="src src-bash">export OCTO_HOME=~/octopress
ogen () {
  cd $OCTO_HOME; rake generate; cd -
}

osave () {
  cd $OCTO_HOME; git commit -am "Updates" &amp;&amp; git push origin source; cd -
}

odeploy () {
  cd $OCTO_HOME; osave; rake gen_deploy; cd -
}

# this one is for orgmode only
opost() {
  cd $OCTO_HOME
  output=$(rake new_post["${1}"])
  new_file=$(echo $output | awk '{print $4}')
  base=$(basename $new_file)
  new_location=$OCTO_HOME/source/org_posts/
  mv $OCTO_HOME/$new_file $new_location
  echo created $new_location/$base
  cd -
}

opage() {
  cd $OCTO_HOME
  rake new_page["${1}"]
  cd -
}
</pre>
</div>
</div>
</div>
<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Emacs setup</h2>
<div class="outline-text-2" id="text-7">
<div class="org-src-container">

<pre class="src src-common-lisp"><span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Justin's customized org to octopress publishing</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">Based on</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">org-mode 8.x+</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">http://blog.paphus.com/blog/2012/08/01/introducing-octopress-blogging-for-org-mode/</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">https://github.com/yoshinari-nomura/org-octopress</span>
<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">See http://wwww.railsonmaui.com</span>

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">the converter from org to jekyll html files</span>
(<span style="color: #F0DFAF; font-weight: bold;">require</span> '<span style="color: #BFEBBF;">ox-jekyll</span>)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">I prefer to use the plugin for source formatting. More colors!</span>
(setq org-jekyll-use-src-plugin t)

<span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">We're going to create the yaml-front-matter in the rake task</span>
(setq org-jekyll-include-yaml-front-matter nil)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">save-then-publish</span> ()
  (interactive)
  (save-buffer)
  (org-save-all-org-buffers)
  (org-publish-current-project))

(setq org-export-with-sub-superscripts `{})

(setq my-common-octopress-settings
      '(<span style="color: #DCDCCC; font-weight: bold;">:base-extension</span> <span style="color: #CC9393;">"org"</span>
                        <span style="color: #DCDCCC; font-weight: bold;">:with-toc</span> nil
                        <span style="color: #DCDCCC; font-weight: bold;">:with-sub-superscript</span> nil 
                        <span style="color: #DCDCCC; font-weight: bold;">:section-numbers</span> nil 
                        <span style="color: #DCDCCC; font-weight: bold;">:recursive</span> t
                        <span style="color: #DCDCCC; font-weight: bold;">:publishing-function</span> org-jekyll-publish-to-html
                        <span style="color: #DCDCCC; font-weight: bold;">:headline-levels</span> 4
                        <span style="color: #DCDCCC; font-weight: bold;">:body-only</span> t))

(setq my-static-directories '(<span style="color: #CC9393;">"about"</span> <span style="color: #CC9393;">"meta"</span> <span style="color: #CC9393;">"tips"</span>))
(setq my-base-directory <span style="color: #CC9393;">"~/j/railsonmaui-octopress/source"</span>)

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">my-create-octopress-static</span> (prj)
  (<span style="color: #F0DFAF; font-weight: bold;">let</span> ((base-dir (expand-file-name prj)))
    `(,prj . (<span style="color: #DCDCCC; font-weight: bold;">:base-directory</span> ,base-dir
                              <span style="color: #DCDCCC; font-weight: bold;">:publishing-directory</span> ,base-dir
                              ,@my-common-octopress-settings))))

(<span style="color: #F0DFAF; font-weight: bold;">defun</span> <span style="color: #93E0E3;">my-static-components</span> ()
  (mapcar 'my-create-octopress-static my-static-directories))

(<span style="color: #F0DFAF; font-weight: bold;">let</span> ((default-directory my-base-directory))
(setq org-publish-project-alist
      `(
        <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">components</span>
        (<span style="color: #CC9393;">"blog"</span> . (<span style="color: #DCDCCC; font-weight: bold;">:components</span> (<span style="color: #CC9393;">"blog-org"</span> <span style="color: #CC9393;">"blog-extra"</span> <span style="color: #CC9393;">"about"</span> <span style="color: #CC9393;">"meta"</span> <span style="color: #CC9393;">"tips"</span>)))

        <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">blog articles</span>
        (<span style="color: #CC9393;">"blog-org"</span> .  (<span style="color: #DCDCCC; font-weight: bold;">:base-directory</span> ,(expand-file-name <span style="color: #CC9393;">"org_posts"</span>)
                                        <span style="color: #DCDCCC; font-weight: bold;">:publishing-directory</span> ,(expand-file-name <span style="color: #CC9393;">"_posts"</span>)
                                        ,@my-common-octopress-settings))
        (<span style="color: #CC9393;">"blog-extra"</span> . (<span style="color: #DCDCCC; font-weight: bold;">:base-directory</span> ,(expand-file-name <span style="color: #CC9393;">"org_posts"</span>)
                                         <span style="color: #DCDCCC; font-weight: bold;">:publishing-directory</span> ,(expand-file-name <span style="color: #CC9393;">"."</span>)
                                         <span style="color: #DCDCCC; font-weight: bold;">:base-extension</span> <span style="color: #CC9393;">"css</span><span style="color: #CC9393; font-weight: bold;">\\</span><span style="color: #CC9393; font-weight: bold;">|</span><span style="color: #CC9393;">pdf</span><span style="color: #CC9393; font-weight: bold;">\\</span><span style="color: #CC9393; font-weight: bold;">|</span><span style="color: #CC9393;">png</span><span style="color: #CC9393; font-weight: bold;">\\</span><span style="color: #CC9393; font-weight: bold;">|</span><span style="color: #CC9393;">jpg</span><span style="color: #CC9393; font-weight: bold;">\\</span><span style="color: #CC9393; font-weight: bold;">|</span><span style="color: #CC9393;">gif</span><span style="color: #CC9393; font-weight: bold;">\\</span><span style="color: #CC9393; font-weight: bold;">|</span><span style="color: #CC9393;">svg"</span>
                                         <span style="color: #DCDCCC; font-weight: bold;">:publishing-function</span> org-publish-attachment
                                         <span style="color: #DCDCCC; font-weight: bold;">:recursive</span> t
                                         <span style="color: #DCDCCC; font-weight: bold;">:author</span> nil))

        <span style="color: #5F7F5F;">;; </span><span style="color: #7F9F7F;">static articles</span>
        ,@(my-static-components))))
</pre>
</div>
</div>
</div>

<div id="outline-container-sec-8" class="outline-2">
<h2 id="sec-8"><span class="section-number-2">8</span> Deploying to Github: Directory Structure of Octopress and the master and source Git Branches</h2>
<div class="outline-text-2" id="text-8">
<p>
Github offers free hosting of both the blog deployment and source. You're
looking at the deployment right now. You can find the source here at
<a href="https://github.com/justin808/justin808.github.io">my git repo justin808.github.io</a>. I doubt you could beat the price, performance, and
convenience. You can look inside of this repo, clone it, etc. and you have
everything that it took to make this blog.
</p>

<p>
I originally was quite confused by the concept of using two separate git
branches to make up what gets deployed on the live website versus the git
repository of my articles. Plus, there's the issue of Octopress git repository
that you clone when starting out. Eventually, I figured out that the two branches
simply contain different files, with one containing the original Octopress
files. Here's a few screen grabs that might clarify the situation for you.
</p>

<p>
Don't forget that you never push to the master branch, but rather the <code>rake
deploy</code> task does it for you. Instead, you run <code>git push origin source</code> to push
the content of your blog to github.
</p>

<p>
The <code>octopress/public</code> directory corresponds to what you'll find on the github
site for your deployment (master branch).
</p>

<p>
{% img /images/2013-04-27-octopress-setup-with-github-and-org-mode/public-dir-corresponds-master-branch.png %}
</p>

<p>
The octopress/.gitignore file contains entries like <code>public</code>, which essentially
keeps the <code>rake generate</code> files out of the source branch.
</p>

<p>
Here's the github master branch right after creation. Note the correspondence
with <code>public</code>. This is what gets deployed as your blog.
{% img /images/2013-04-27-octopress-setup-with-github-and-org-mode/github-master-branch.png %}
</p>

<p>
Here's the github source branch. This contains the octopress environment, as
well as your customizations and blog posts.
</p>
{% img /images/2013-04-27-octopress-setup-with-github-and-org-mode/github-source-branch.png %}
</div>
</div>
<div id="outline-container-sec-9" class="outline-2">
<h2 id="sec-9"><span class="section-number-2">9</span> Useful Links</h2>
<div class="outline-text-2" id="text-9">
<ol class="org-ol">
<li><a href="http://webdesign.tutsplus.com/tutorials/applications/getting-started-with-octopress/">Getting Started with Octopress</a>: Nice overall tutorial. Very current!
March 2013.
</li>
<li><a href="http://robdodson.me/blog/2012/04/30/custom-domain-with-octopress-and-github-pages">Rob Dodson on Octopress</a>: Most of the instructions I show below are from this
posting on April 30th, 2012.
</li>
<li><a href="http://joelmccracken.github.io/entries/octopress-is-pretty-sweet/">Joel McCracken on Octopress</a>: Use Jekyll? You Really Should Be Using Octopress
</li>
<li><a href="https://help.github.com/articles/setting-up-a-custom-domain-with-pages">Github directions on setting up a custom domain</a>
</li>
<li><a href="http://code.dblock.org/octopress-setting-up-a-blog-and-contributing-to-an-existing-one">dblock.org Article on Octopress</a>: A good explanation from Jan 17, 2012,
especially on the difference of the source and master branches.
</li>
<li><a href="http://blog.paphus.com/blog/2012/08/01/introducing-octopress-blogging-for-org-mode/">Introducing Octopress Blogging for Org-Mode</a>: For org-mode. See below.
</li>
<li><a href="http://hiltmon.com/blog/2013/04/17/18-months-of-octopress/">18 Months of Octopress</a>: Nice article on why Octopress was worth the switch.
</li>
<li><a href="http://odino.org/bash-aliases-for-octopress/">Shell Aliases for Octopress</a>: Save time with these shortcuts
</li>
<li><a href="https://github.com/yoshinari-nomura/org-octopress">org-octopress package</a>: The connection between emacs/org-mode and octopress.
</li>
</ol>
</div>
</div>
<div id="outline-container-sec-10" class="outline-2">
<h2 id="sec-10"><span class="section-number-2">10</span> Live Reload</h2>
<div class="outline-text-2" id="text-10">
<p>
Previously, I tried to get Live Reload to work. It would be neat it worked, but
I ran into a snag. The browser gets triggered to update before the Jekyll page
is generated. I tried some various techniques for working around this, but
nothing seemed reliable. If you figure out how to fix this, please let me know.
</p>
</div>
</div>
<div id="outline-container-sec-11" class="outline-2">
<h2 id="sec-11"><span class="section-number-2">11</span> Parting words&#x2026;</h2>
<div class="outline-text-2" id="text-11">
<p>
Thanks in advance for any suggestions on this article. I hope you find it
helpful. 
</p>
</div>
</div>
</div>
<div id="postamble" class="status">
<p class="author">Author: Justin Gordon</p>
<p class="date">Created: 2014-03-07 Fri 07:33</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 24.3.1 (<a href="http://orgmode.org">Org</a> mode 8.2.3c)</p>
<p class="validation"><a href="http://validator.w3.org/check?uri=referer">Validate</a></p>
</div>
</body>
</html>
